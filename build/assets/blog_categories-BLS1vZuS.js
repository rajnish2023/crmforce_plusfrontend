import{r as t,j as e}from"./index-CNDwPbcK.js";import{b as Y,i as Z,j as ee,k as se}from"./api-B9qGc84N.js";import{C as S,a as d}from"./CRow-C_mFcwcj.js";import{a as l}from"./CContainer-CCuO_NJc.js";import{C as re}from"./CInputGroup-BUs0JMgv.js";import{C as N,a as b,b as F}from"./CFormInput-D4b8rLgv.js";import{C as te,a as ae,b as M,c as u,d as le,e as C}from"./CTable-DMjTmETu.js";import{C as k,a as I,b as L,c as V,d as _}from"./CModalTitle-hn51-tnD.js";import{C as oe}from"./CForm-CIYK7ixP.js";import{C as ce}from"./CFormSelect-x_UCku4i.js";import"./DefaultLayout-Bapu6jUF.js";import"./index.esm-Dsfv9R7D.js";import"./cil-user-Dlmw-Gem.js";const ve=()=>{const[B,o]=t.useState(!1),[m,H]=t.useState(""),[w,h]=t.useState([]),[a,c]=t.useState({title:"",slug:"",status:"Active"}),[g,R]=t.useState({title:"",slug:""}),[T,n]=t.useState(""),[q,p]=t.useState(!1),[j,y]=t.useState(null),[x,E]=t.useState(null),f=async()=>{try{const s=await Y();Array.isArray(s.data)?h(s.data):h([])}catch(s){console.error("Error fetching categories:",s),h([])}};t.useEffect(()=>{f()},[]);const U=s=>{H(s.target.value)},z=s=>{const{name:r,value:i}=s.target;c(v=>({...v,[r]:i}))},A=()=>{const s={};let r=!0;return a.title||(s.title="Title is required.",r=!1),a.slug||(s.slug="Slug is required.",r=!1),R(s),r},G=async()=>{if(A())try{const s=await Z(a);f(),c({title:"",slug:"",status:"Active"}),o(!1),n("")}catch(s){console.error("Error creating category:",s),s.response&&s.response.data?n(s.response.data.message||"An error occurred while creating the category."):n("An internal server error occurred.")}},$=s=>{y(s),p(!0)},J=async()=>{if(j)try{await ee(j._id),h(w.filter(s=>s._id!==j._id))}catch(s){console.error("Error deleting category:",s)}p(!1),y(null)},D=()=>{p(!1),y(null)},K=s=>{const{value:r}=s.target;c(i=>{const v=i.slug||P(r);return{...i,title:r,slug:v}})},O=s=>{const{value:r}=s.target;c(i=>({...i,slug:r}))},P=s=>s.toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),Q=s=>{E(s),c({title:s.title,slug:s.slug,status:s.status}),o(!0)},W=async()=>{if(A())try{await se(x._id,a),f(),E(null),c({title:"",slug:"",status:"Active"}),o(!1),n("")}catch(s){console.error("Error updating category:",s),s.response&&s.response.data?n(s.response.data.message||"An error occurred while updating the category."):n("An internal server error occurred.")}},X=w.filter(s=>(s.title?s.title.toLowerCase():"").includes(m.toLowerCase())||(s.slug?s.slug.toLowerCase():"").includes(m.toLowerCase()));return e.jsxs(S,{children:[e.jsx(d,{xs:6,className:"d-flex justify-content-start",children:e.jsx(l,{color:"primary",onClick:()=>o(!0),children:"Create Category"})}),e.jsx(d,{xs:6,className:"d-flex justify-content-end",children:e.jsx(re,{children:e.jsx(N,{placeholder:"Search category...",value:m,onChange:U})})}),e.jsx(d,{xs:12,className:"mt-4",children:e.jsxs(te,{striped:!0,hover:!0,children:[e.jsx(ae,{children:e.jsxs(M,{children:[e.jsx(u,{scope:"col",className:"py-3 px-4",children:"#"}),e.jsx(u,{scope:"col",className:"py-3 px-4",children:"Title"}),e.jsx(u,{scope:"col",className:"py-3 px-4",children:"Slug"}),e.jsx(u,{scope:"col",className:"py-3 px-4",children:"Status"}),e.jsx(u,{scope:"col",className:"py-3 px-4",children:"Actions"})]})}),e.jsx(le,{children:X.map((s,r)=>e.jsxs(M,{children:[e.jsx(u,{scope:"row",className:"py-3 px-4",children:r+1}),e.jsx(C,{className:"py-3 px-4",children:s.title}),e.jsx(C,{className:"py-3 px-4",children:s.slug}),e.jsx(C,{className:"py-3 px-4",children:s.status}),e.jsxs(C,{className:"py-3 px-4",children:[e.jsx(l,{className:"mx-3",color:"info",onClick:()=>Q(s),children:"Edit"}),e.jsx(l,{color:"danger",onClick:()=>$(s),children:"Delete"})]})]},s._id))})]})}),e.jsxs(k,{visible:q,onClose:D,children:[e.jsx(I,{children:e.jsx(L,{children:"Confirm Deletion"})}),e.jsx(V,{children:e.jsx("p",{children:"Are you sure you want to delete this category?"})}),e.jsxs(_,{children:[e.jsx(l,{color:"secondary",onClick:D,children:"Cancel"}),e.jsx(l,{color:"danger",onClick:J,children:"Delete"})]})]}),e.jsxs(k,{visible:B,onClose:()=>o(!1),size:"lg",children:[e.jsx(I,{children:e.jsx(L,{children:x?"Edit Category":"Create New Category"})}),e.jsx(V,{children:e.jsxs(oe,{children:[T&&e.jsx("div",{className:"text-danger mb-3",children:T}),"  ",e.jsxs(S,{children:[e.jsxs(d,{xs:6,className:"mb-3",children:[e.jsx(b,{htmlFor:"categoryTitle",children:"Category Title"}),e.jsx(N,{id:"categoryTitle",name:"title",placeholder:"Enter category title",value:a.title,onChange:K}),g.title&&e.jsx(F,{className:"text-danger",children:g.title})]}),e.jsxs(d,{xs:6,className:"mb-3",children:[e.jsx(b,{htmlFor:"categorySlug",children:"Slug"}),e.jsx(N,{id:"categorySlug",name:"slug",placeholder:"Enter category slug",value:a.slug,onChange:O}),g.slug&&e.jsx(F,{className:"text-danger",children:g.slug})]})]}),e.jsx(S,{children:e.jsxs(d,{xs:6,className:"mb-3",children:[e.jsx(b,{htmlFor:"categoryStatus",children:"Status"}),e.jsxs(ce,{id:"categoryStatus",name:"status",value:a.status,onChange:z,children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"})]})]})})]})}),e.jsxs(_,{children:[e.jsx(l,{color:"secondary",onClick:()=>o(!1),children:"Cancel"}),e.jsx(l,{color:"primary",onClick:x?W:G,children:x?"Update":"Create"})]})]})]})};export{ve as default};
